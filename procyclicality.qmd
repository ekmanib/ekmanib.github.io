---
title: "Exploring Fiscal Cyclical Patterns Across the World"
subtitle: "Replicating key and interesting figures from 'On graduation from fiscal procyclicality'"
author: Elías José Mantilla Ibarra
monofont: "Fira Code"
---

## Paper's Summary
Frankel, Vegh, and Vuletin (2011) proposed that the observed shifts from procyclical to countercyclical fiscal policies across a number of economies for the time period ranging from the 1960's to 2000's is due to superior or improved quality of the economy's institutions. They achieved this by means of regression analysis. Indeed, their results show that, even after controlling for other factors that influence the conduct of fiscal policy, the quality of institutions remains a significant and economically important factor. They conclude that higher quality of institutions is associated with reduced procyclicality.

The conduct of fiscal policy matters for a reason. Procyclical fiscal policies, that is, either increased government purchases or reduced tax rates during periods of economic boom and its counterpart, decreased government purchases and tax raises during periods of recessions and burst, are said to exacerbate and prolong the business cycle. By contrast, countercyclical fiscal policy attenuates the business cycle.

Empirical exercises show that, over the past 5 decades, countries exhibiting countercyclical fiscal regimes are overwhelmingly developed and industrialized whereas those exhibiting procyclical are less developed. This fact appears in line with what is observed in other indicators used to gauge the maturity of fiscal policy such as the debt to GDP ratio, rankings by rating agencies and sovereign spreads. The interesting fact singled out by this paper consist of the exploration of changes in the cyclicality of the fiscal regime occurred in some countries.

It is shown that those countries who were once procyclical and are now countercyclical - those termed 'recent graduates' according to the authors - have had a major increase in the quality of their institutions. The quality of institutions was measured as an average of four indices from the International Country Risk Guide dataset. Panel data models were fitted with and without controls to soundly establish the relation between government outlays cyclicality and institutional quality. Results show that institutional quality is, indeed, associated with reduced procyclicality. Further, it is argued that improvements in institutional quality are responsible for the strength of the relationship. Throughout the time periods under study, institutional quality remains unaffected, except for the class of 'recent graduates' that experienced the largest increase.

## Exploratory Analysis
The World Economic Outlook and the International Country Risk Guide datasets were the main data sources. From these we can obtain time series of real GDP, government expenditures and the four basic indicators to represent institutional quality used in the paper. The results of this partial replication are presented as follows. First, the data must be rearranged and transformed. Second, a general overview of the correlation between government expenditures and real GPD by means of graphical devices. Third, an overview of the influence of institutional quality to the fiscal regime. 

### Data Wrangling
Our main dataset - the World Economic Forum - must be transformed. The following operations were performed. Data contents were pivoted from wide to long format. The data column containing variable names was pivoted from long to wide format. Finally, the data rows were filtered for countries with a population over 1 million people and whose share of the economic world is over 0.1 percent.

```{r}
#| warning: false
#| error: false
#| code-fold: true

# load all packages in the tidyverse, plus additional packages
library(tidyverse)
library(reshape2)

# Read in and transform the Word Economic Outlook dataset
df <- 
  read_tsv('./datasets/procyclicality/weo.txt') %>%
  select(-c('WEO Country Code', 'ISO', 
            'Units', 'Scale',
            'Subject Descriptor', 
            'Subject Notes',
            'Country/Series-specific Notes')) %>%
  filter(`WEO Subject Code` %in% c('NGDP_R', 'GGX', 'LP', 'PPPSH')) %>% 
  pivot_longer(cols = -c('WEO Subject Code', 'Country'), 
               names_to = 'Year') %>% 
  pivot_wider(id_cols = c('Country', 'Year'), 
              names_from = 'WEO Subject Code') %>%
  mutate(
    across(everything(), ~ifelse(. == 'n/a', NA, .)),
    across(
      c(Year, NGDP_R, PPPSH, LP, GGX), 
      ~as.numeric(gsub(',', '', .))
      )
    )

# Further filter the dataset:
# Only countries with population above 1 million and a share of word gross product
df <-
  df %>%
  filter(
    Country %in% 
      (df %>% 
         group_by(Country) %>%
         summarise(pop = last(LP), ppp = nth(PPPSH, 42)) %>%
         filter(pop > 1, ppp > 0.1) %>%
         pull(Country)),
    Year >= 1995,
    Country!='Venezuela'
  ) %>%
  rename(NGDPR=NGDP_R) %>%
  select(-c(LP, PPPSH))

```

### Fiscal Procyclicality Across The World

```{r}
#| warning: false
#| error: false
#| code-fold: true
#| output-location: column
#| fig-width: 12
#| fig-height: 6
#| fig-format: svg

# Load up the library containing the routine for the Hodrick-Prescott filter
library(mFilter)
library(zoo)

# Obtain the cyclical component of GDP and Government expenditures
df <-
  df %>%
  group_by(Country) %>%
  mutate(
    across(c(NGDPR, GGX),
           ~na.locf(., fromLast=TRUE)),
    across(c(NGDPR, GGX),
           ~hpfilter(log(.), freq=1)$cycle,
           .names = '{col}_CYC'),
  )
```

```{r}
#| warning: false
#| error: false
#| code-fold: true
#| output-location: column
#| fig-width: 12
#| fig-height: 6
#| fig-format: svg

df %>%
  group_by(Country) %>%
  summarise(COR = cor(NGDPR_CYC, GGX_CYC)) %>%
  ggplot(aes(x=reorder(Country, COR), y=COR)) +
  geom_bar(stat = 'identity', width=0.4, fill = '#213cb0') +
  scale_y_continuous(breaks = seq(-1, 1, 0.25)) +
  labs(
    title = 'Across-Country Correlations Between Cyclical Components of GDP and Government Purchases',
    subtitle = '',
    x = '',
    y = ''
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    panel.grid.major.y = element_line(size = .1, color = 'black')
  )
```



```{r}
#| warning: false
#| error: false
#| code-fold: true
#| output-location: column
#| fig-width: 12
#| fig-height: 6
#| fig-format: svg

# Plot rolling correlations
df %>%
  group_by(Country) %>%
  transmute(ROLCOR = rollapplyr(cbind(NGDPR_CYC, GGX_CYC), 
                             width=5,
                             FUN=function(x) cor(x[, 1], x[, 2]),
                             by.column=FALSE,
                             fill=NA),
            Year = Year) %>%
  ggplot(aes(x = Year, 
             y = ROLCOR, 
             group=Country,
             color=Country,
             alpha=Country)) +
  geom_line() +
  xlim(1999, 2022) +
  ylim(-1., 1.) +
  scale_color_manual(values = c('Ecuador'='#d6c720', 'Chile'='blue', 'Canada'='red'), 
                     na.value = 'gray') +
  scale_alpha_manual(values = c('Ecuador'=1, 'Chile'=1, 'Canada'=1),
                     na.value = 0.2) + 
  labs(
    title='Rolling Correlation Between The Cyclical Components of GDP and Government Purchases',
    y = '',
    x = 'Year'
  ) + 
  theme_minimal() +
  theme(
    panel.grid.major.y = element_line(size = .1, color = 'black')
  )


```

### Institutional Quality and Fiscal Procyclicality

## References
Frankel, Jeffrey A., Carlos A. Vegh, and Guillermo Vuletin, 2011, "On Graduation from Fiscal Procyclicality." NBER Working Paper No. 17619 (Cambridge, Massachusetts: National Bureau of Economic Research)
